@model Web.Models.HomeViewModel
@{
    ViewData["Title"] = "Hem";
    ViewBag.Weather = Model.CurrentWeather;
}

<div class="container mt-4">
    <!-- Hero Section -->
    <div class="hero-section text-center text-white mb-5 p-5 rounded-3"
         style="background: linear-gradient(135deg, rgba(0,102,204,0.8), rgba(255,102,0,0.8)), url('https://picsum.photos/1200/400?random=99') center/cover;">
        <h1 class="display-4 fw-bold mb-3" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
            Välkommen till NätOnNät!
        </h1>
        <p class="lead mb-4" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
            Din destination för den senaste tekniken - alltid till rätt pris!
        </p>
        <div class="d-flex justify-content-center gap-3">
            <button class="btn btn-light btn-lg px-4">
                <i class="bi bi-bag-check"></i> Shoppa nu
            </button>
            <button class="btn btn-outline-light btn-lg px-4">
                <i class="bi bi-percent"></i> Erbjudanden
            </button>
        </div>
    </div>

    <!-- Favorite Products Section -->
    <section class="mb-5">
        <div class="section-header">
            <h2><i class="bi bi-star-fill text-warning"></i> Våra favoriter</h2>
            <p class="text-white-50">Handplockade produkter som våra kunder älskar</p>
        </div>
        <div class="row g-4">
            @foreach (var product in Model.FavoriteProducts)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="product-card h-100">
                        @if (product.IsFavorite)
                        {
                            <span class="product-badge badge bg-warning text-dark">
                                <i class="bi bi-star-fill"></i> Favorit
                            </span>
                        }
                        <div class="img-container">
                            <img src="@product.ImageUrl" alt="@product.Name">
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">@product.Name</h5>
                            <p class="card-text text-muted small">@product.Description</p>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="price-tag">@product.FormattedPrice</span>
                                    @if (product.InStock)
                                    {
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle"></i> I lager
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">Slut i lager</span>
                                    }
                                </div>
                                <button class="btn btn-primary w-100" @(product.InStock ? "" : "disabled")>
                                    <i class="bi bi-cart-plus"></i> Lägg i varukorg
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>

    <!-- Newest Products Section -->
    <section class="mb-5">
        <div class="section-header">
            <h2><i class="bi bi-lightning-charge-fill text-info"></i> Nyheter</h2>
            <p class="text-white-50">De senaste produkterna i vårt sortiment</p>
        </div>
        <div class="row g-4">
            @foreach (var product in Model.NewestProducts)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="product-card h-100">
                        @if (product.IsNew)
                        {
                            <span class="product-badge badge bg-info">
                                <i class="bi bi-lightning-charge"></i> Ny!
                            </span>
                        }
                        <div class="img-container">
                            <img src="@product.ImageUrl" alt="@product.Name">
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">@product.Name</h5>
                            <p class="card-text text-muted small">@product.Description</p>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="price-tag">@product.FormattedPrice</span>
                                    <span class="badge bg-secondary">@product.Category</span>
                                </div>
                                <button class="btn btn-primary w-100" @(product.InStock ? "" : "disabled")>
                                    <i class="bi bi-cart-plus"></i> Lägg i varukorg
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>

    <!-- All Products Section -->
    <section class="mb-5">
        <div class="section-header">
            <h2><i class="bi bi-grid-3x3-gap-fill"></i> Alla produkter</h2>
            <p class="text-white-50">Hela vårt sortiment sorterat efter namn</p>
        </div>
        <div class="row g-4">
            @foreach (var product in Model.AllProducts)
            {
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="product-card h-100">
                        @if (product.IsFavorite)
                        {
                            <span class="product-badge badge bg-warning text-dark">
                                <i class="bi bi-star-fill"></i>
                            </span>
                        }
                        else if (product.IsNew)
                        {
                            <span class="product-badge badge bg-info">Ny!</span>
                        }
                        <div class="img-container" style="height: 150px;">
                            <img src="@product.ImageUrl" alt="@product.Name">
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title">@product.Name</h6>
                            <p class="card-text text-muted small text-truncate">@product.Description</p>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="price-tag fs-6">@product.FormattedPrice</span>
                                    @if (!product.InStock)
                                    {
                                        <span class="badge bg-danger small">Slut</span>
                                    }
                                </div>
                                <button class="btn btn-sm btn-primary w-100" @(product.InStock ? "" : "disabled")>
                                    <i class="bi bi-cart-plus"></i> Köp
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section text-white text-center py-5">
        <div class="row g-4">
            <div class="col-md-3 col-6">
                <div class="feature-box p-3">
                    <i class="bi bi-truck fs-1 text-info"></i>
                    <h5 class="mt-2">Fri frakt</h5>
                    <p class="small">På order över 500kr</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="feature-box p-3">
                    <i class="bi bi-shield-check fs-1 text-success"></i>
                    <h5 class="mt-2">Säker betalning</h5>
                    <p class="small">100% säkra transaktioner</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="feature-box p-3">
                    <i class="bi bi-arrow-counterclockwise fs-1 text-warning"></i>
                    <h5 class="mt-2">30 dagars retur</h5>
                    <p class="small">Öppet köp i 30 dagar</p>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="feature-box p-3">
                    <i class="bi bi-headset fs-1 text-danger"></i>
                    <h5 class="mt-2">Support 24/7</h5>
                    <p class="small">Vi finns här för dig</p>
                </div>
            </div>
        </div>
    </section>
</div>

@section Scripts {
    <script>
        // Add to cart animation
        document.querySelectorAll('.btn-primary').forEach(btn => {
            btn.addEventListener('click', function(e) {
                if (!this.disabled && !this.id?.includes('subscribe')) {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Lägger till...';
                    setTimeout(() => {
                        this.innerHTML = '<i class="bi bi-check-circle"></i> Tillagd!';
                        this.classList.add('btn-success');
                        this.classList.remove('btn-primary');
                        setTimeout(() => {
                            this.innerHTML = originalText;
                            this.classList.remove('btn-success');
                            this.classList.add('btn-primary');
                        }, 2000);
                    }, 1000);
                }
            });
        });

        // Lazy loading for images
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.classList.add('fade-in');
                        observer.unobserve(img);
                    }
                });
            });

            document.querySelectorAll('.product-card img').forEach(img => {
                imageObserver.observe(img);
            });
        }
    </script>

    <style>
        /* Additional product card styles for better hover effect */
        .product-card {
            position: relative;
            isolation: isolate;
        }

            .product-card .img-container {
                position: relative;
                overflow: hidden;
                background: #f8f9fa;
                flex-shrink: 0;
            }

            .product-card .card-body {
                position: relative;
                background: white;
                z-index: 1;
                flex: 1;
            }

        /* Ensure hover effect doesn't affect neighboring cards */
        .row > [class*='col-'] {
            position: relative;
            z-index: 1;
        }

            .row > [class*='col-']:hover {
                z-index: 10;
            }

        .feature-box {
            transition: transform 0.3s ease;
        }

            .feature-box:hover {
                transform: translateY(-10px);
            }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .hero-section {
            animation: slideDown 0.8s ease-out;
        }

        @@keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Product grid spacing fix */
        .product-card {
            margin-bottom: 0 !important;
        }

        /* Smooth transitions for all interactive elements */
        .btn {
            transition: all 0.3s ease;
        }

        /* Prevent text overflow in small cards */
        .product-card .card-title {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
}